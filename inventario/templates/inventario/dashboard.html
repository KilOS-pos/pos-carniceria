{% extends "inventario/base.html" %}

{% block title %}Dashboard de Ventas{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="mb-0">游늳 {{ titulo }}</h1>
    <div>
        <a href="{% url 'dashboard' %}?periodo=hoy" class="btn btn-success">Ventas de Hoy</a>
        <a href="{% url 'dashboard' %}?periodo=semana" class="btn btn-primary">칔ltimos 7 D칤as</a>
        <a href="{% url 'dashboard' %}?periodo=mes" class="btn btn-secondary">칔ltimos 30 D칤as</a>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <canvas id="graficaVentas"></canvas>
    </div>
</div>

<script>
    const etiquetas = JSON.parse('{{ etiquetas_json|escapejs }}');
    const datos = JSON.parse('{{ datos_json|escapejs }}');
    // Recibimos el tipo de gr치fica desde la vista
    const tipoGrafica = '{{ tipo_grafica }}';

    const ctx = document.getElementById('graficaVentas');

    new Chart(ctx, {
        // El tipo de gr치fica ahora es din치mico
        type: tipoGrafica,
        data: {
            labels: etiquetas,
            datasets: [{
                label: 'Ventas ($)',
                data: datos,
                backgroundColor: tipoGrafica === 'line' ? 'rgba(52, 152, 219, 0.2)' : 'rgba(231, 76, 60, 0.7)',
                borderColor: tipoGrafica === 'line' ? 'rgba(52, 152, 219, 1)' : 'rgba(192, 57, 43, 1)',
                borderWidth: tipoGrafica === 'line' ? 2 : 1,
                borderRadius: tipoGrafica === 'line' ? 0 : 5,
                fill: tipoGrafica === 'line', // Rellenar el 치rea bajo la l칤nea
                tension: 0.1 // Suavizar la l칤nea
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return '$' + value.toLocaleString('es-MX');
                        }
                    }
                }
            },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.dataset.label || '';
                            if (label) {
                                label += ': ';
                            }
                            if (context.parsed.y !== null) {
                                label += new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN' }).format(context.parsed.y);
                            }
                            return label;
                        }
                    }
                }
            }
        }
    });
</script>
{% endblock %}